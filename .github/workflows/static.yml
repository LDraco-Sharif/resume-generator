name: Deploy Angular App to GitHub Pages

on:
  push:
    branches:
      - main  # Trigger the action on pushing to the `main` branch

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout the repository
      - name: Checkout Repository
        uses: actions/checkout@v3

      # 2. Setup Node.js (You can change the version if needed)
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'  # Specify Node version

      # 3. Install dependencies
      - name: Install Dependencies
        run: npm install

      # 4. Build the Angular app
      - name: Build Angular Project
        run: npm run build --configuration=production

      # 5. List contents of the dist folder (For debugging)
      - name: List dist contents
        run: ls -R dist/

      # 6. Deploy to GitHub Pages (push dist folder to gh-pages branch)
      - name: Deploy to GitHub Pages
        run: |
          # Set up Git config
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # Create gh-pages branch if it doesn't exist
          git checkout -b gh-pages

          # Remove all files in the branch (if any)
          git rm -rf .

          # Copy the built files from the dist folder to the root of the repository
          cp -a dist/resume-generator/browser/. ./

          # Commit and push the changes
          git add .
          git commit -m "Deploy Angular app to GitHub Pages"
          git push --force "https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git" gh-pages
          
      # Optional: Verify deployment URL
      - name: Verify Deployment URL
        run: curl -I https://ldraco-sharif.github.io/resume-generator/




# name: Deploy Angular App to GitHub Pages

# on:
#   push:
#     branches:
#       - main

# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout Repository
#         uses: actions/checkout@v3

#       - name: Use Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: '20'

#       - name: Install Dependencies
#         run: npm install

#       - name: Build Angular Project
#         run: npm run build --configuration=production
     
#       - name: List dist contents
#         run: ls -R dist/
      
#       - name: Angular Deploy gh-pages Actions
#         # You may pin to the exact commit or the version.
#         # uses: AhsanAyaz/angular-deploy-gh-pages-actions@2272ef32f364bc80d8680ee03d8e58f126156c31
#         uses: AhsanAyaz/angular-deploy-gh-pages-actions@v1.4.0
#         with:
#           # Github access token token used to deploy on gh_pages. You can find it on Github.
#           github_access_token: ${{ secrets.GITHUB_TOKEN }}
#           # The directory of the angular project, in which all the commands will run
#           angular_project_dir: ./ # optional, default is ./
#           # Build configuration for the angular app
#           build_configuration: production # optional, default is production
#           # base href for the app
#           base_href: /resume-generator # optional, default is /
#           # branch on which the angular build will be deployed
#           deploy_branch: gh-pages # optional, default is gh-pages
#           # The folder in which `ng build` provides its output. This is the folder which will be deployed to the `deploy_branch`.
#           angular_dist_build_folder: dist/resume-generator/browser # optional, default is dist
#           # If the action should run 'ng lint'
#           run_lint: # optional
#           # Will not fail the step if anything fails
#           skip_failure: # optional
                
#     #  - name: Deploy to gh-pages
#      #   uses: AhsanAyaz/angular-deploy-gh-pages-actions@v1.4.0
#      #   with:
#      ##     github_access_token: ${{ secrets.GITHUB_TOKEN }}
#      #     angular_project_dir: ./
#      #     build_configuration: production
#      #     base_href: /resume-generator/
#      #     deploy_branch: gh-pages
#      #     angular_dist_build_folder: dist/resume-generator
